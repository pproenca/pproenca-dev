@import "tailwindcss";
@plugin "@tailwindcss/typography";

/* Configure dark mode to use class strategy (for next-themes compatibility) */
@custom-variant dark (&:where(.dark, .dark *));

/* Exclude documentation from Tailwind scanning */
@source not "../../openspec";
@source not "../../content";
@source not "../../docs";

@theme inline {
  /* Golden ratio spacing scale (Fibonacci-based)
     φ ≈ 1.618 creates naturally pleasing proportions */
  --spacing-golden-1: 0.5rem; /* 8px  - micro gaps */
  --spacing-golden-2: 0.8125rem; /* 13px - small margins */
  --spacing-golden-3: 1.3125rem; /* 21px - standard rhythm */
  --spacing-golden-4: 2.125rem; /* 34px - section margins */
  --spacing-golden-5: 3.4375rem; /* 55px - major breaks */
  --spacing-golden-6: 5.5625rem; /* 89px - page-level */

  /* Theme colors - reference CSS variables for dark mode switching
     Enables cleaner syntax: bg-bg-deep instead of bg-(--color-bg-deep) */
  --color-bg-deep: var(--color-bg-deep);
  --color-bg-surface: var(--color-bg-surface);
  --color-bg-elevated: var(--color-bg-elevated);
  --color-text-primary: var(--color-text-primary);
  --color-text-secondary: var(--color-text-secondary);
  --color-text-tertiary: var(--color-text-tertiary);
  --color-accent: var(--color-accent);
  --color-accent-muted: var(--color-accent-muted);
  --color-border-subtle: var(--color-border-subtle);
  --color-border-visible: var(--color-border-visible);
  --color-border: var(--color-border-visible); /* alias */

  /* Terminal traffic light colors - base and hover states
     Values switch via CSS variables in :root/.dark below */
  --color-terminal-red: var(--color-terminal-red);
  --color-terminal-yellow: var(--color-terminal-yellow);
  --color-terminal-green: var(--color-terminal-green);
  --color-terminal-red-active: var(--color-terminal-red-active);
  --color-terminal-yellow-active: var(--color-terminal-yellow-active);
  --color-terminal-green-active: var(--color-terminal-green-active);

  /* Code block background for Shiki themes */
  --color-code-bg: var(--color-code-bg);

  /* Transition duration tokens */
  --duration-fast: 150ms;
  --duration-base: 200ms;
  --duration-slow: 300ms;
}

/* ========================================
   Kindle Reading Theme - Digital Paper
   ======================================== */

:root {
  /* Light Mode: Aged Paper - e-ink inspired (OKLCH for perceptual uniformity) */
  --color-bg-deep: oklch(95.5% 0.012 85);
  --color-bg-surface: oklch(92.5% 0.015 85);
  --color-bg-elevated: oklch(89.5% 0.018 85);
  --color-text-primary: oklch(30% 0.02 70);
  --color-text-secondary: oklch(48% 0.02 70);
  --color-text-tertiary: oklch(49% 0.015 70);
  --color-accent: oklch(50% 0.09 70);
  --color-accent-muted: oklch(48% 0.08 70);
  --color-border-subtle: oklch(87.5% 0.012 85);
  --color-border-visible: oklch(82% 0.015 85);

  /* Paper texture for light mode */
  --paper-texture: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
  --paper-texture-visible: block;

  /* Terminal traffic light colors - light mode */
  --color-terminal-red: oklch(73% 0.05 55);
  --color-terminal-yellow: oklch(78% 0.04 90);
  --color-terminal-green: oklch(75% 0.04 130);
  --color-terminal-red-active: oklch(62% 0.18 25);
  --color-terminal-yellow-active: oklch(78% 0.15 85);
  --color-terminal-green-active: oklch(72% 0.16 145);

  /* Code block background - GitHub Light */
  --color-code-bg: oklch(100% 0 0);

  /* Terminal window shadows - light mode */
  --shadow-terminal:
    0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1),
    0 0 0 1px rgba(0, 0, 0, 0.05);
  --shadow-terminal-hover:
    0 8px 12px -2px rgba(0, 0, 0, 0.12), 0 4px 6px -2px rgba(0, 0, 0, 0.08),
    0 0 0 1px rgba(0, 0, 0, 0.05);

  /* Terminal header - no gradient in light mode */
  --terminal-header-bg: none;

  /* Transitions */
  --transition-fast: 150ms ease;
  --transition-base: 200ms ease;
  --transition-slow: 300ms ease;
}

.dark {
  /* Dark Mode: Night Reading - OLED optimized (OKLCH for perceptual uniformity) */
  --color-bg-deep: oklch(8% 0.01 70);
  --color-bg-surface: oklch(12% 0.01 70);
  --color-bg-elevated: oklch(16% 0.012 70);

  /* Warm Cream Text (not pure white) */
  --color-text-primary: oklch(85% 0.015 70);
  --color-text-secondary: oklch(65% 0.012 70);
  --color-text-tertiary: oklch(
    67% 0.012 70
  ); /* WCAG AA compliant: ~6:1 contrast ratio */

  /* Soft Gold Accents */
  --color-accent: oklch(65% 0.08 70);
  --color-accent-muted: oklch(60% 0.07 70);

  /* Subtle Warm Borders */
  --color-border-subtle: oklch(20% 0.01 70);
  --color-border-visible: oklch(28% 0.01 70);

  /* No paper texture in dark mode (OLED clean) */
  --paper-texture-visible: none;

  /* Terminal traffic light colors - dark mode (muted) */
  --color-terminal-red: oklch(40% 0.06 35);
  --color-terminal-yellow: oklch(45% 0.06 85);
  --color-terminal-green: oklch(42% 0.05 130);
  --color-terminal-red-active: oklch(58% 0.17 25);
  --color-terminal-yellow-active: oklch(73% 0.13 85);
  --color-terminal-green-active: oklch(68% 0.15 145);

  /* Code block background - Monokai */
  --color-code-bg: oklch(22% 0.02 100);

  /* Terminal window shadows - dark mode */
  --shadow-terminal:
    0 8px 16px -4px rgba(0, 0, 0, 0.4), 0 4px 8px -4px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.03);
  --shadow-terminal-hover:
    0 12px 24px -6px rgba(0, 0, 0, 0.5), 0 6px 12px -6px rgba(0, 0, 0, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.04);

  /* Terminal header gradient - dark mode */
  --terminal-header-bg: linear-gradient(
    to bottom,
    rgba(255, 255, 255, 0.02) 0%,
    transparent 100%
  );
}

/* Prevent horizontal scroll on mobile */
html,
body {
  overflow-x: hidden;
}

/* Base body styles - bg/color/transition handled by Tailwind utilities in layout.tsx */
/* Responsive font sizing: mobile → sm → md+ */
body {
  font-size: 16px;
}

@media (min-width: 640px) {
  body {
    font-size: 17px;
  }
}

@media (min-width: 768px) {
  body {
    font-size: 18px;
  }
}

/* Paper texture overlay - light mode only */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: var(--paper-texture);
  pointer-events: none;
  z-index: 9999;
  mix-blend-mode: multiply;
  display: var(--paper-texture-visible);
}

/* ========================================
   Prose Typography - Kindle Reading Theme
   ======================================== */

.prose {
  --tw-prose-body: var(--color-text-primary);
  --tw-prose-headings: var(--color-text-primary);
  --tw-prose-lead: var(--color-text-secondary);
  --tw-prose-links: var(--color-accent);
  --tw-prose-bold: var(--color-text-primary);
  --tw-prose-counters: var(--color-text-tertiary);
  --tw-prose-bullets: var(--color-text-tertiary);
  --tw-prose-hr: var(--color-border-subtle);
  --tw-prose-quotes: var(--color-text-secondary);
  --tw-prose-quote-borders: var(--color-accent);
  --tw-prose-captions: var(--color-text-tertiary);
  --tw-prose-code: var(--color-text-primary);
  --tw-prose-pre-code: var(--color-text-primary);
  --tw-prose-pre-bg: var(--color-bg-elevated);
  --tw-prose-th-borders: var(--color-border-visible);
  --tw-prose-td-borders: var(--color-border-subtle);
}

/* Prose headings use serif font */
.prose h1,
.prose h2,
.prose h3,
.prose h4 {
  font-family: var(--font-serif);
  font-weight: 700;
}

/* Generous line height for comfortable reading */
.prose p {
  line-height: 1.75;
}

/* Golden rhythm for prose elements - tighter on mobile */
.prose > * + * {
  margin-top: var(--spacing-golden-2);
}

@media (min-width: 768px) {
  .prose > * + * {
    margin-top: var(--spacing-golden-3);
  }
}

.prose h2 {
  margin-top: var(--spacing-golden-5);
  margin-bottom: var(--spacing-golden-3);
}

.prose h3 {
  margin-top: var(--spacing-golden-4);
  margin-bottom: var(--spacing-golden-2);
}

/* Link styling with underline */
.prose a {
  color: var(--color-accent);
  text-decoration: underline;
  text-decoration-color: var(--color-accent-muted);
  text-underline-offset: 2px;
  transition:
    color var(--transition-base),
    text-decoration-color var(--transition-base);
}

.prose a:hover {
  color: var(--color-accent-muted);
  text-decoration-color: var(--color-accent);
}

/* Blockquote styling - book-like with subtle border */
.prose blockquote {
  border-left: 2px solid var(--color-border-subtle);
  font-style: italic;
  color: var(--color-text-secondary);
  padding-left: var(--spacing-golden-3);
  margin-top: var(--spacing-golden-4);
  margin-bottom: var(--spacing-golden-4);
}

/* List spacing */
.prose ul,
.prose ol {
  padding-left: var(--spacing-golden-3);
}

.prose li {
  margin-top: var(--spacing-golden-1);
  margin-bottom: var(--spacing-golden-1);
}

/* Inline code styling */
.prose :not(pre) > code {
  background-color: var(--color-bg-elevated);
  border: 1px solid var(--color-border-subtle);
  border-radius: 4px;
  padding: 2px 6px;
  font-size: 0.875em;
}

.prose code::before,
.prose code::after {
  content: none;
}

/* ========================================
   Code Block Styling
   ----------------------------------------
   !important flags override Shiki's inline
   styles for consistent theme appearance.
   ======================================== */

pre {
  @apply overflow-x-auto rounded-lg text-sm;
  background-color: var(--color-bg-elevated) !important;
  border: 1px solid var(--color-border-subtle);
  padding: 1.25rem;
}

pre code {
  @apply font-mono;
  background-color: transparent !important;
}

.prose pre {
  @apply bg-transparent p-0;
  background-color: var(--color-bg-elevated) !important;
}

/* Shiki theme backgrounds */
.shiki {
  @apply overflow-x-auto;
  background-color: transparent !important;
  border: none;
  padding: 1.25rem;
}

/* ========================================
   Terminal Window - macOS Inspired
   ======================================== */

.terminal-window {
  @apply overflow-hidden rounded-xl;
  background-color: var(--color-bg-elevated);
  border: 1px solid var(--color-border-subtle);
  box-shadow: var(--shadow-terminal);
  transition:
    box-shadow var(--transition-base),
    transform var(--transition-base);

  &:hover {
    box-shadow: var(--shadow-terminal-hover);
  }
}

/* Terminal Header - Minimal Title Bar */
.terminal-header {
  @apply flex items-center justify-between px-3 py-2;
  background: var(--terminal-header-bg);
  background-color: var(--color-bg-surface);
  border-bottom: 1px solid var(--color-border-subtle);
}

/* Traffic Light Dots - Mac-inspired, theme-harmonized */
.terminal-dots {
  @apply flex items-center gap-1.5;
}

.terminal-dot {
  @apply block h-2.5 w-2.5 rounded-full;
  transition:
    background-color var(--transition-base),
    transform var(--transition-fast),
    box-shadow var(--transition-base);
}

/* Traffic light dots - colors switch via CSS variables in :root/.dark */
.terminal-dot-red {
  background-color: var(--color-terminal-red);
}

.terminal-dot-yellow {
  background-color: var(--color-terminal-yellow);
}

.terminal-dot-green {
  background-color: var(--color-terminal-green);
}

/* Hover: reveal active traffic light colors */
.terminal-window:hover .terminal-dot-red {
  background-color: var(--color-terminal-red-active);
  box-shadow: 0 0 8px oklch(from var(--color-terminal-red-active) l c h / 0.35);
}

.terminal-window:hover .terminal-dot-yellow {
  background-color: var(--color-terminal-yellow-active);
  box-shadow: 0 0 8px
    oklch(from var(--color-terminal-yellow-active) l c h / 0.35);
}

.terminal-window:hover .terminal-dot-green {
  background-color: var(--color-terminal-green-active);
  box-shadow: 0 0 8px
    oklch(from var(--color-terminal-green-active) l c h / 0.35);
}

/* Copy Button */
.terminal-copy {
  @apply flex items-center justify-center rounded p-1;
  color: var(--color-text-tertiary);
  opacity: 0;
  transition: all var(--transition-base);
}

.terminal-window:hover .terminal-copy {
  opacity: 1;
}

.terminal-copy:hover {
  color: var(--color-accent);
  background-color: var(--color-bg-elevated);
}

.terminal-copy:active {
  transform: scale(0.95);
}

/* Terminal Body - responsive padding */
.terminal-body {
  @apply relative;
  padding: 1rem;
  background-color: var(--color-code-bg);
}

@media (min-width: 640px) {
  .terminal-body {
    padding: 1.25rem 1.5rem;
  }
}

.terminal-body .shiki {
  margin: 0;
  padding: 0 !important;
  border-radius: 0;
}

.terminal-body pre {
  margin: 0;
  padding: 0 !important;
  border: none;
  border-radius: 0;
  background-color: transparent !important;
}

.terminal-body code {
  font-size: 0.8rem;
  line-height: 1.7;
}

@media (min-width: 640px) {
  .terminal-body code {
    font-size: 0.875rem;
  }
}

/* Override prose pre styling for terminal */
.prose .terminal-window {
  margin-top: var(--spacing-golden-4);
  margin-bottom: var(--spacing-golden-4);
}

.prose .terminal-window pre {
  margin: 0;
  padding: 0 !important;
  background-color: transparent !important;
}

.prose .terminal-body .shiki {
  padding: 0 !important;
  background-color: transparent !important;
}

/* ========================================
   Focus States & Accessibility
   ======================================== */

/* Focus visible styling */
:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 4px;
}

/* Remove default focus styles for mouse users */
:focus:not(:focus-visible) {
  outline: none;
}

/* Reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 1ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 1ms !important;
    scroll-behavior: auto !important;
  }
}

/* Selection styling */
::selection {
  background-color: var(--color-accent);
  color: var(--color-bg-deep);
}

/* ========================================
   Tweet Embed - Literary Integration
   ======================================== */

.react-tweet-theme {
  /* Typography - match site system */
  --tweet-font-family: inherit;
  --tweet-body-font-size: 1rem;
  --tweet-body-line-height: 1.75;
  --tweet-header-font-size: 0.875rem;
  --tweet-info-font-size: 0.75rem;
  --tweet-actions-font-size: 0.75rem;

  /* Transparent container - no card */
  --tweet-bg-color: transparent;
  --tweet-bg-color-hover: transparent;
  --tweet-border: none;

  /* Colors match site */
  --tweet-font-color: var(--color-text-primary);
  --tweet-font-color-secondary: var(--color-text-secondary);

  /* Accent for links */
  --tweet-color-blue-primary: var(--color-accent);
  --tweet-color-blue-primary-hover: var(--color-accent-muted);
  --tweet-color-blue-secondary: var(--color-accent);
  --tweet-color-blue-secondary-hover: var(--color-accent-muted);

  /* Muted action colors */
  --tweet-color-red-primary: var(--color-text-tertiary);
  --tweet-color-green-primary: var(--color-text-tertiary);

  /* Near-invisible provenance */
  --tweet-twitter-icon-color: var(--color-border-subtle);
  --tweet-verified-blue-color: var(--color-text-tertiary);
}

/* Integration into prose - blockquote rhythm */
.prose .react-tweet-theme {
  margin-left: 0;
  margin-right: auto;
  margin-top: var(--spacing-golden-4);
  margin-bottom: var(--spacing-golden-4);
  padding-left: var(--spacing-golden-3);
  max-width: 100%;
  /* Force overrides - CSS variables alone don't override module styles */
  background-color: transparent !important;
  border-radius: 0 !important;
  border: none !important;
  border-left: 2px solid var(--color-border-subtle) !important;
}

/* Fragile selectors: depend on react-tweet internals, verify after library updates */

/* Author name - use serif like headings */
.react-tweet-theme [data-testid="User-Name"] a {
  font-family: var(--font-serif) !important;
  font-weight: 400;
}

/* Hide action stats */
.react-tweet-theme [class*="tweet-actions"] {
  display: none !important;
}

/* Clean link styling */
.react-tweet-theme a {
  text-decoration: none !important;
}

/* Reduce X icon visibility */
.react-tweet-theme svg[viewBox="0 0 24 24"]:not([class*="avatar"]) {
  opacity: 0.4;
}

/* Fix CLS from unsized tweet images */
.react-tweet-theme img[src*="pbs.twimg.com/profile_images"] {
  width: 48px;
  height: 48px;
  aspect-ratio: 1;
}

/* Reserve space for tweet media to prevent layout shifts */
.react-tweet-theme img[src*="pbs.twimg.com/media"],
.react-tweet-theme img[src*="pbs.twimg.com/amplify_video_thumb"] {
  aspect-ratio: 16/9;
  width: 100%;
  height: auto;
  object-fit: cover;
}

/* ========================================
   Mobile Menu Dialog
   ======================================== */

/* Dialog backdrop fade-in animation */
dialog[open]::backdrop {
  animation: mobile-menu-backdrop-fade var(--transition-base) ease-out;
}

/* Drawer slide-in animation */
dialog[open] .mobile-menu-drawer {
  animation: mobile-menu-slide-in var(--transition-slow) ease-out;
}

@keyframes mobile-menu-backdrop-fade {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes mobile-menu-slide-in {
  from {
    transform: translateX(100%);
  }
  to {
    transform: translateX(0);
  }
}

/* ========================================
   Resources Navigation - MDX Component
   ======================================== */

.resources-nav a {
  @apply inline-flex items-center gap-2 rounded-full px-4 py-2;
  @apply text-sm font-medium;
  @apply bg-bg-elevated text-text-primary;
  @apply border border-border-subtle;
  @apply no-underline;
  @apply transition-all duration-200;
}

.resources-nav a:hover {
  @apply border-accent text-accent shadow-sm;
}
